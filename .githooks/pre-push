#!/bin/sh

# Pre-push hook script to run code quality checks and ensure consistency.
#
# This script will execute two custom scripts located in the `scripts/` directory:
# 1. clippy-on-all-workspaces.sh: Runs Clippy, tests, and formatting on all specified workspaces.
# 2. sv2-header-check.sh: Ensures the `sv2.h` file generated by `build_header.sh` matches the
#    committed version.

# Exit immediately if any command exits with a non-zero status and print each command before
# executing it.
set -xe

# Run clippy, test, and rustfmt on all workspaces
sh ./scripts/clippy-on-all-workspaces.sh
if [ $? -ne 0 ]; then
    echo "Clippy checks or tests failed."
    exit 1
fi

# Run sv2 header check
sh ./scripts/sv2-header-check.sh
if [ $? -ne 0 ]; then
    echo "SV2 header check failed."
    exit 1
fi

echo "Pre-push checks passed successfully."
